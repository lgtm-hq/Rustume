# SPDX-License-Identifier: MIT
---
name: PR - Title Validation
# Validates PR titles follow Conventional Commits format.
# Uses lgtm-ci semantic-pr-title action.

"on":
  pull_request:
    types: [opened, edited, synchronize, reopened, ready_for_review]

permissions:
  contents: read
  pull-requests: write

jobs:
  check:
    name: ðŸ“ Validate PR Title
    runs-on: ubuntu-24.04
    timeout-minutes: 5
    defaults:
      run:
        shell: bash
    concurrency:
      group: semantic-pr-title-${{ github.ref }}
      cancel-in-progress: true

    steps:
      - name: Harden Runner
        # yamllint disable-line rule:line-length
        uses: lgtm-hq/lgtm-ci/.github/actions/harden-runner@v0
        with:
          egress-policy: block
          allowed-endpoints: >
            github.com:443
            api.github.com:443

      - name: Validate PR title
        id: semantic
        # yamllint disable-line rule:line-length
        uses: lgtm-hq/lgtm-ci/.github/actions/semantic-pr-title@v0
        with:
          types: >-
            chore,ci,docs,feat,fix,perf,refactor,revert,style,test,build

      - name: Post failure comment
        if: steps.semantic.outputs.valid != 'true'
        # yamllint disable-line rule:line-length
        uses: lgtm-hq/lgtm-ci/.github/actions/post-pr-comment@v0
        with:
          marker: "<!-- semantic-pr-title -->"
          body: |
            ## PR Title Validation Failed

            Your PR title does not follow Conventional Commits format.

            **Error:** ${{ steps.semantic.outputs.error }}

            **Expected format:** `type(scope): description`

            **Allowed types:** `chore`, `ci`, `docs`, `feat`, `fix`,
            `perf`, `refactor`, `revert`, `style`, `test`, `build`
